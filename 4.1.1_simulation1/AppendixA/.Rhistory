load("/home/ziang/Documents/Paper-for-Cox-PH-Model/SMMR_revision1/new_codes/simulation1/diff_size/resultdiff5000_case2.Rda")
load("/home/ziang/Documents/Paper-for-Cox-PH-Model/SMMR_revision1/new_codes/simulation1/diff_size/resultdiff5000_case1.Rda")
library(tidyverse)
library(aghq)
library(mgcv)
library(Matrix)
library(rstan)
library(TMB)
library(INLA)
library(tmbstan)
library(foreach)
library(doMC)
library(parallel)
library(foreach)
library(abcoxph)
library(mvQuad)
library(doParallel)
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>%
mutate(Proposed = beta_mse_aghq, INLA = beta_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-10,0))
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>% mutate(Proposed = frailty_mse_aghq,INLA = frailty_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-1.5,0.5))
TEXT_SIZE <- 25
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>%
mutate(Proposed = beta_mse_aghq, INLA = beta_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-10,0))
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>% mutate(Proposed = frailty_mse_aghq,INLA = frailty_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-1.5,0.5))
as.data.frame(resultdiff) %>% filter(frailty_cov_aghq >= 0) %>%
mutate(Proposed = beta_mse_aghq, INLA = beta_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-10,0))
as.data.frame(resultdiff) %>% filter(frailty_cov_aghq >= 0) %>% mutate(Proposed = frailty_mse_aghq,INLA = frailty_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-1,0.5))
as.data.frame(resultdiff) %>% filter(frailty_cov_aghq >= 0) %>%
mutate(Proposed = beta_mse_aghq, INLA = beta_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-10,0))
ggsave("beta_mse_diff_size.png", width = 5, height = 5)
as.data.frame(resultdiff) %>% filter(frailty_cov_aghq >= 0) %>% mutate(Proposed = frailty_mse_aghq,INLA = frailty_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-1,0.5))
ggsave("fra_mse_diff_size.png", width = 5, height = 5)
### Also a sparse case:
group_size_vec <- c(rep(1,30),rep(2,28),rep(6,2))
time_begin <- Sys.time()
resultdiff2 <- foreach(i = 1:M,.combine = rbind, .packages = c('foreach', 'stats', 'INLA', 'aghq', 'abcoxph')) %dopar% do_once_diff_size(seed = i, beta = beta, group_size_vec = group_size_vec, sdtheta = sd, bas = "piecewiseconstant")
time_end <- Sys.time()
time_end - time_begin
colnames(resultdiff2) <- c("beta_cov_aghq","beta_cov_inla","beta_mse_aghq","beta_mse_inla","frailty_cov_aghq","frailty_cov_inla", "frailty_mse_aghq", "frailty_mse_inla")
save(resultdiff2, file = "resultdiff5000_case2.Rda")
agg_means_diff2 <- apply(resultdiff2, 2, mean)
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>%
mutate(Proposed = beta_mse_aghq, INLA = beta_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-10,0))
ggsave("beta_mse_diff_size2.png", width = 5, height = 5)
as.data.frame(resultdiff2) %>% filter(frailty_cov_aghq >= 0) %>% mutate(Proposed = frailty_mse_aghq,INLA = frailty_mse_inla) %>%
pivot_longer(cols = Proposed:INLA, names_to = "method", values_to = "MSE") %>%
ggplot() + geom_boxplot(aes(x = method, y = log(MSE), fill = method), outlier.shape = NA) +
theme_classic(base_size = TEXT_SIZE) +
theme(legend.position = "none") +
xlab("") + ylim(c(-1.5,0.5))
ggsave("fra_mse_diff_size2.png", width = 5, height = 5)
